<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Chunk Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-popIn { animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        /* å†ç”Ÿä¸­ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .progress-bar { transition: width 0.1s linear; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ---
        const IconBase = ({ children, className }) => <span className={`inline-flex items-center justify-center ${className}`}>{children}</span>;
        const Play = ({ className }) => <IconBase className={className}>â–¶</IconBase>;
        const Pause = ({ className }) => <IconBase className={className}>â¸</IconBase>;
        const RotateCcw = ({ className }) => <IconBase className={className}>â†º</IconBase>;
        const Check = ({ className }) => <IconBase className={className}>âœ“</IconBase>;
        const ArrowRight = ({ className }) => <IconBase className={className}>â†’</IconBase>;
        const BookOpen = ({ className }) => <IconBase className={className}>ğŸ“–</IconBase>;
        const Ear = ({ className }) => <IconBase className={className}>ğŸ‘‚</IconBase>;
        const Info = ({ className }) => <IconBase className={className}>â„¹ï¸</IconBase>;
        const Settings = ({ className }) => <IconBase className={className}>âš™ï¸</IconBase>;
        const ChevronRight = ({ className }) => <IconBase className={className}>â€º</IconBase>;
        const ChevronLeft = ({ className }) => <IconBase className={className}>â€¹</IconBase>;
        const Upload = ({ className }) => <IconBase className={className}>ğŸ“¤</IconBase>;
        const FileText = ({ className }) => <IconBase className={className}>ğŸ“„</IconBase>;
        const Music = ({ className }) => <IconBase className={className}>ğŸµ</IconBase>;
        const X = ({ className }) => <IconBase className={className}>âœ•</IconBase>;
        const Save = ({ className }) => <IconBase className={className}>ğŸ’¾</IconBase>;
        const Trash2 = ({ className }) => <IconBase className={className}>ğŸ—‘</IconBase>;
        const Loader2 = ({ className }) => <IconBase className={`${className} animate-spin`}>âŒ›</IconBase>;
        const AlertCircle = ({ className }) => <IconBase className={className}>âš ï¸</IconBase>;
        const ListIcon = ({ className }) => <IconBase className={className}>â˜°</IconBase>;
        const Clock = ({ className }) => <IconBase className={className}>ğŸ•’</IconBase>;

        // --- åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ (Podcastç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ) ---
        // ID | Timestamp | English | Japanese | Chunks...
        const DEFAULT_CSV_CONTENT = `ID|ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—|è‹±æ–‡|æ—¥æœ¬èªè¨³|ãƒãƒ£ãƒ³ã‚¯1|ãƒãƒ£ãƒ³ã‚¯2|ãƒãƒ£ãƒ³ã‚¯3|ãƒãƒ£ãƒ³ã‚¯4
1|0|A new cold war has broken out between the US and China over artificial intelligence.|äººå·¥çŸ¥èƒ½ã‚’å·¡ã£ã¦ã€ã‚¢ãƒ¡ãƒªã‚«ã¨ä¸­å›½ã®é–“ã§æ–°ã—ã„å†·æˆ¦ãŒå‹ƒç™ºã—ã¾ã—ãŸã€‚|A new cold war has broken out^Subject + Verb^core^æ–°ã—ã„å†·æˆ¦ãŒå‹ƒç™ºã—ãŸ|between the US and China^Prep Phrase^modifier^ã‚¢ãƒ¡ãƒªã‚«ã¨ä¸­å›½ã®é–“ã§|over artificial intelligence.^Prep Phrase^modifier^äººå·¥çŸ¥èƒ½ã‚’å·¡ã£ã¦
2|10|The US and China are locked in a competition that bears some really striking similarities to the tech races between the US and Soviet Union.|ã‚¢ãƒ¡ãƒªã‚«ã¨ä¸­å›½ã¯ã€æŠ€è¡“ç«¶äº‰ã¨é¡ä¼¼ç‚¹ã‚’æŒã¤ç«¶äº‰ã®ä¸­ã§è† ç€çŠ¶æ…‹ã«ã‚ã‚Šã¾ã™ã€‚|The US and China are locked^S+V^core^ç±³ä¸­ã¯è† ç€çŠ¶æ…‹ã«ã‚ã‚‹|in a competition^Prep Phrase^modifier^ã‚ã‚‹ç«¶äº‰ã®ä¸­ã§|that bears^Relative Clause^connector^ï¼ˆãã®ç«¶äº‰ã¯ï¼‰æŒã£ã¦ã„ã‚‹|some really striking similarities^Object^core^ã„ãã¤ã‹ã®éå¸¸ã«éš›ç«‹ã£ãŸé¡ä¼¼ç‚¹ã‚’
3|25|Josh says that history is repeating itself with AI.|ã‚¸ãƒ§ã‚·ãƒ¥ã¯ã€AIã«ãŠã„ã¦æ­´å²ã¯ç¹°ã‚Šè¿”ã—ã¦ã„ã‚‹ã¨è¨€ã„ã¾ã™ã€‚|Josh says^S+V^core^ã‚¸ãƒ§ã‚·ãƒ¥ã¯è¨€ã†|that history is repeating itself^Noun Clause^core^æ­´å²ã¯ç¹°ã‚Šè¿”ã—ã¦ã„ã‚‹ã¨|with AI.^Prep Phrase^modifier^AIã«ãŠã„ã¦
4|35|Whichever country manages to run away with a lead stands to reap huge advantages in economic and military power.|ãƒªãƒ¼ãƒ‰ã‚’å¥ªã„å»ã‚‹ã“ã¨ã«æˆåŠŸã—ãŸå›½ã¯ã©ã“ã§ã‚ã‚Œã€è«å¤§ãªåˆ©ç›Šã‚’å¾—ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚|Whichever country manages^Subject Clause^core^ä½•ã¨ã‹ã—ã‚ˆã†ã¨ã™ã‚‹å›½ã¯ã©ã“ã§ã‚‚|to run away with a lead^Infinitive^modifier^ãƒªãƒ¼ãƒ‰ã‚’å¥ªã„å»ã‚‹ï¼ˆç‹¬èµ°ã™ã‚‹ï¼‰|stands to reap^Verb Phrase^core^ï¼ˆåˆ©ç›Šã‚’ï¼‰å¾—ã‚‹ç«‹å ´ã«ã‚ã‚‹|huge advantages^Object^core^è«å¤§ãªåˆ©ç›Šã‚’`;

        // è‰²åˆ†ã‘è¨­å®š
        const TYPE_COLORS = {
            core: "bg-red-100 text-red-800 border-red-200",
            modifier: "bg-green-100 text-green-800 border-green-200",
            connector: "bg-blue-100 text-blue-800 border-blue-200"
        };

        function PodcastChunkMaster() {
            // --- State ---
            const [sentences, setSentences] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [mode, setMode] = useState('study'); 
            const [isPlayingTTS, setIsPlayingTTS] = useState(false);
            const [playbackRate, setPlaybackRate] = useState(1.0);
            const [showMeaning, setShowMeaning] = useState(false);
            
            // Podcast Audio State
            const [podcastAudioSrc, setPodcastAudioSrc] = useState(null);
            const [isAudioPlaying, setIsAudioPlaying] = useState(false);
            const [audioCurrentTime, setAudioCurrentTime] = useState(0);
            const audioPlayerRef = useRef(null);
            
            // UI State
            const [csvInput, setCsvInput] = useState(DEFAULT_CSV_CONTENT);
            const [importError, setImportError] = useState(null);
            const [jumpIdInput, setJumpIdInput] = useState("");

            // Quiz State
            const [shuffledChunks, setShuffledChunks] = useState([]);
            const [selectedChunks, setSelectedChunks] = useState([]);
            const [quizResult, setQuizResult] = useState(null);

            const synthesisRef = useRef(window.speechSynthesis);

            // ç¾åœ¨ã®ã‚»ãƒ³ãƒ†ãƒ³ã‚¹
            const currentSentence = sentences[currentIndex] || {};
            // æ¬¡ã®ã‚»ãƒ³ãƒ†ãƒ³ã‚¹ï¼ˆçµ‚äº†æ™‚é–“ã®åˆ¤å®šç”¨ï¼‰
            const nextSentence = sentences[currentIndex + 1];

            // --- Effects ---
            
            // åˆæœŸãƒ­ãƒ¼ãƒ‰
            useEffect(() => {
                parseCSV(DEFAULT_CSV_CONTENT, true);
            }, []);

            // ã‚»ãƒ³ãƒ†ãƒ³ã‚¹åˆ‡ã‚Šæ›¿ãˆæ™‚ã®å‡¦ç†
            useEffect(() => {
                resetQuiz();
                cancelSpeech();
                
                // è¡ŒãŒå¤‰ã‚ã£ãŸã‚‰ã€ãã®è¡Œã®é–‹å§‹æ™‚é–“ã¸ã‚·ãƒ¼ã‚¯ã—ã¦å†ç”Ÿ
                if (podcastAudioSrc && audioPlayerRef.current) {
                    const startTime = currentSentence.timestamp || 0;
                    audioPlayerRef.current.currentTime = startTime;
                    setAudioCurrentTime(startTime);
                    
                    // è‡ªå‹•å†ç”Ÿï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¾Œã®ã¿æœ‰åŠ¹ãªå ´åˆãŒå¤šã„ï¼‰
                    playPodcastSegment();
                }
            }, [currentIndex]); // sentencesã‚’å«ã‚ã‚‹ã¨å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§å¤–ã™

            // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç›£è¦–ï¼ˆæŒ‡å®šåŒºé–“çµ‚ã‚ã£ãŸã‚‰æ­¢ã‚ã‚‹ï¼‰
            useEffect(() => {
                if (!isAudioPlaying || !podcastAudioSrc) return;

                const checkTime = () => {
                    const player = audioPlayerRef.current;
                    if (!player) return;

                    setAudioCurrentTime(player.currentTime);

                    // çµ‚äº†æ™‚é–“ã®æ±ºå®š: æ¬¡ã®è¡Œã®é–‹å§‹æ™‚é–“ã€‚ã‚‚ã—æ¬¡ã®è¡ŒãŒãªã‘ã‚Œã°ã€éŸ³å£°ã®æœ€å¾Œã¾ã§ï¼ˆåˆ¶é™ãªã—ï¼‰
                    const endTime = nextSentence ? nextSentence.timestamp : player.duration;

                    // ãƒãƒƒãƒ•ã‚¡ï¼ˆ0.2ç§’ãã‚‰ã„ï¼‰ã‚’æŒãŸã›ã¦åœæ­¢åˆ¤å®š
                    if (player.currentTime >= endTime && endTime > 0) {
                        player.pause();
                        setIsAudioPlaying(false);
                    }
                };

                const interval = setInterval(checkTime, 100);
                return () => clearInterval(interval);
            }, [isAudioPlaying, nextSentence, podcastAudioSrc]);

            // --- Functions ---

            // CSVãƒ‘ãƒ¼ã‚µãƒ¼ (Podcastç‰ˆ: ID | Time | Text | Trans | Chunks...)
            const parseCSV = (text, isAutoLoad = false) => {
                try {
                    const lines = text.trim().split('\n');
                    const newSentences = lines.map((line, index) => {
                        const cleanLine = line.trim().replace(/^\uFEFF/, '');
                        // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ•°å­—ã§å§‹ã¾ã‚‰ãªã„ã€ã‹ã¤IDç­‰ã®æ–‡å­—ã‚’å«ã‚€å ´åˆï¼‰
                        if (index === 0 && (cleanLine.toLowerCase().startsWith('id') || cleanLine.includes('è‹±æ–‡') || cleanLine.includes('source'))) return null;
                        if (!cleanLine) return null;

                        const parts = cleanLine.split('|').map(p => p.trim());
                        // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: ID | Timestamp | English | Japanese | Chunks...
                        if (parts.length < 4) return null;

                        let idVal = parseInt(parts[0], 10);
                        if (isNaN(idVal)) idVal = index + 1;

                        // Podcastç‰ˆã®åˆ—å®šç¾©
                        const timestampStr = parts[1];
                        const timestamp = parseFloat(timestampStr) || 0;
                        const sentenceText = parts[2];
                        const translation = parts[3];
                        
                        // ãƒãƒ£ãƒ³ã‚¯ã¯5åˆ—ç›®(index 4)ä»¥é™
                        const chunkRawData = parts.slice(4);
                        
                        const chunks = chunkRawData.map(chunkStr => {
                            if (!chunkStr) return null;
                            const [cText, cLabel, cType, cJp] = chunkStr.split('^').map(s => s?.trim());
                            return {
                                text: cText || "",
                                label: cLabel || "",
                                type: (cType === 'core' || cType === 'modifier' || cType === 'connector') ? cType : 'core',
                                japanese: cJp || ""
                            };
                        }).filter(c => c && c.text);

                        return { 
                            id: idVal, 
                            timestamp: timestamp, // ç§’
                            text: sentenceText, 
                            translation: translation, 
                            chunks: chunks 
                        };
                    }).filter(Boolean);

                    if (newSentences.length === 0) throw new Error("æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");

                    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—é †ã€ã‚ã‚‹ã„ã¯IDé †ã«ã‚½ãƒ¼ãƒˆã—ãŸã»ã†ãŒå®‰å…¨ã ãŒã€ä»Šå›ã¯CSVã®ä¸¦ã³é †ã‚’æ­£ã¨ã™ã‚‹
                    setSentences(newSentences);
                    setCurrentIndex(0);
                    setMode('study');
                    setImportError(null);

                    if (!isAutoLoad) alert(`${newSentences.length} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
                    return true;
                } catch (e) {
                    setImportError(e.message);
                    if (!isAutoLoad) alert(e.message);
                    return false;
                }
            };

            // PodcastéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
            const handlePodcastUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (podcastAudioSrc) URL.revokeObjectURL(podcastAudioSrc);
                    const url = URL.createObjectURL(file);
                    setPodcastAudioSrc(url);
                    alert(`PodcastéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: ${file.name}`);
                }
            };

            const playPodcastSegment = () => {
                cancelSpeech();
                if (audioPlayerRef.current && podcastAudioSrc) {
                    // ç¾åœ¨ã®æ™‚é–“ãŒç¯„å›²å¤–ãªã‚‰ã€é–‹å§‹ä½ç½®ã«æˆ»ã™
                    const startTime = currentSentence.timestamp;
                    const endTime = nextSentence ? nextSentence.timestamp : 999999;
                    
                    // ã¾ã é–‹å§‹ä½ç½®ã‚ˆã‚Šå‰ã€ã‚ã‚‹ã„ã¯çµ‚äº†ä½ç½®ã‚ˆã‚Šå¾Œã‚ã«ã„ã‚‹å ´åˆã¯ã‚·ãƒ¼ã‚¯
                    if (audioPlayerRef.current.currentTime < startTime || audioPlayerRef.current.currentTime >= endTime) {
                         audioPlayerRef.current.currentTime = startTime;
                    }
                    
                    audioPlayerRef.current.play().then(() => {
                        setIsAudioPlaying(true);
                    }).catch(e => {
                        console.error("Audio playback error:", e);
                    });
                } else {
                    if(!podcastAudioSrc) alert("PodcastéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šç”»é¢ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚");
                }
            };

            const pausePodcast = () => {
                if (audioPlayerRef.current) {
                    audioPlayerRef.current.pause();
                    setIsAudioPlaying(false);
                }
            };

            const cancelSpeech = () => {
                if (synthesisRef.current) {
                    synthesisRef.current.cancel();
                    setIsPlayingTTS(false);
                }
            };

            const speakText = (text, rate = 1.0) => {
                pausePodcast();
                cancelSpeech();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = rate;
                utterance.onend = () => setIsPlayingTTS(false);
                setIsPlayingTTS(true);
                synthesisRef.current.speak(utterance);
            };

            // --- Quiz Logic ---
            const resetQuiz = () => {
                if (!currentSentence.chunks) return;
                const chunksWithId = currentSentence.chunks.map((c, i) => ({ ...c, id: i }));
                const shuffled = [...chunksWithId].sort(() => Math.random() - 0.5);
                setShuffledChunks(shuffled);
                setSelectedChunks([]);
                setQuizResult(null);
            };

            const handleChunkSelect = (chunk) => {
                if (quizResult === 'correct') return;
                setShuffledChunks(prev => prev.filter(c => c.id !== chunk.id));
                setSelectedChunks(prev => [...prev, chunk]);
            };

            const handleChunkDeselect = (chunk) => {
                if (quizResult === 'correct') return;
                setSelectedChunks(prev => prev.filter(c => c.id !== chunk.id));
                setShuffledChunks(prev => [...prev, chunk]);
            };

            const checkAnswer = () => {
                const currentAnswer = selectedChunks.map(c => c.text).join(' ');
                const normalize = str => str.replace(/[.,]/g, '').trim().toLowerCase();
                const isCorrect = normalize(currentAnswer) === normalize(currentSentence.text);
                setQuizResult(isCorrect ? 'correct' : 'incorrect');
            };

            const handleJumpToId = () => {
                const idToJump = parseInt(jumpIdInput, 10);
                const targetIndex = sentences.findIndex(s => s.id === idToJump);
                if (targetIndex !== -1) {
                    setCurrentIndex(targetIndex);
                } else {
                    alert(`ID ${idToJump} ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`);
                }
                setJumpIdInput("");
            };

            if (sentences.length === 0) return <div className="p-10 text-center">Loading...</div>;

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¨ˆç®—ï¼ˆç¾åœ¨ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã§ã®é€²è¡Œåº¦ï¼‰
            const segmentStart = currentSentence.timestamp || 0;
            const segmentEnd = nextSentence ? nextSentence.timestamp : (audioPlayerRef.current?.duration || segmentStart + 10);
            const segmentDuration = segmentEnd - segmentStart;
            const currentProgress = Math.max(0, Math.min(100, ((audioCurrentTime - segmentStart) / segmentDuration) * 100));

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans pb-20">
                    <audio 
                        ref={audioPlayerRef} 
                        src={podcastAudioSrc} 
                        onEnded={()=> setIsAudioPlaying(false)} 
                        onError={() => setIsAudioPlaying(false)} 
                    />

                    <header className="bg-slate-900 text-white p-4 shadow-md sticky top-0 z-20">
                        <div className="max-w-md mx-auto flex justify-between items-center">
                            <h1 className="text-lg font-bold flex items-center gap-2">
                                <Music className="w-5 h-5 text-green-400" />
                                Podcast Chunk Master
                            </h1>
                            <button onClick={()=> setMode(mode === 'settings' ? 'study' : 'settings')} className={`p-2 rounded-full transition ${mode === 'settings' ? 'bg-slate-700' : 'hover:bg-slate-800'}`}>
                                {mode === 'settings' ? <X className="w-5 h-5" /> : <Settings className="w-5 h-5" />}
                            </button>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4 space-y-6">
                        
                        {/* ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ (Study/Quizå…±é€š) */}
                        {mode !== 'settings' && (
                            <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-200 sticky top-[70px] z-10">
                                <div className="flex justify-between items-end mb-2">
                                    <div className="text-xs font-bold text-gray-400 flex items-center gap-1">
                                        <Clock className="w-3 h-3" />
                                        {Math.floor(currentSentence.timestamp / 60)}:{(currentSentence.timestamp % 60).toFixed(0).padStart(2, '0')}
                                        <span className="font-normal text-gray-300 mx-1">/</span>
                                        {nextSentence ? `${Math.floor(nextSentence.timestamp / 60)}:${(nextSentence.timestamp % 60).toFixed(0).padStart(2, '0')}` : 'End'}
                                    </div>
                                    <div className="text-xs font-mono text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded">
                                        ID: {currentSentence.id}
                                    </div>
                                </div>
                                
                                <div className="h-1.5 bg-gray-100 rounded-full overflow-hidden mb-4">
                                    <div className="h-full bg-green-500 progress-bar" style={{ width: `${currentProgress}%` }}></div>
                                </div>

                                <div className="flex items-center gap-2">
                                    <button onClick={() => setCurrentIndex(prev => Math.max(0, prev - 1))} disabled={currentIndex === 0} className="p-3 bg-gray-100 rounded-full hover:bg-gray-200 disabled:opacity-30 transition"><ChevronLeft className="w-5 h-5 text-gray-600" /></button>
                                    
                                    <button onClick={isAudioPlaying ? pausePodcast : playPodcastSegment} className={`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold shadow-md transition ${isAudioPlaying ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-slate-800 text-white hover:bg-slate-700'}`}>
                                        {isAudioPlaying ? <Pause className="w-5 h-5" /> : <Play className="w-5 h-5" />}
                                        {isAudioPlaying ? "Pause" : "Play Segment"}
                                    </button>

                                    <button onClick={() => setCurrentIndex(prev => Math.min(sentences.length - 1, prev + 1))} disabled={currentIndex === sentences.length - 1} className="p-3 bg-gray-100 rounded-full hover:bg-gray-200 disabled:opacity-30 transition"><ChevronRight className="w-5 h-5 text-gray-600" /></button>
                                </div>
                            </div>
                        )}

                        {mode === 'settings' ? (
                            <div className="space-y-6 animate-fadeIn">
                                {/* è¨­å®š: CSVå…¥åŠ› */}
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2"><FileText className="w-5 h-5 text-indigo-600" />å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿</h2>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-bold text-gray-700 mb-2">CSVãƒ‡ãƒ¼ã‚¿ (ID|Time|En|Jp|Chunk...)</label>
                                        <div className="bg-gray-50 p-2 text-[10px] text-gray-500 font-mono mb-2 overflow-x-auto whitespace-pre border border-gray-200 rounded">
                                            1|0|Hello.|ã“ã‚“ã«ã¡ã¯|Hello^Greeting^core^ã‚„ã‚...<br/>
                                            2|5.5|Next sentence.|æ¬¡ã¸|...
                                        </div>
                                        <textarea 
                                            className="w-full h-32 p-3 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none font-mono leading-relaxed" 
                                            value={csvInput} 
                                            onChange={(e)=> setCsvInput(e.target.value)} 
                                        />
                                        <button onClick={() => parseCSV(csvInput)} className="mt-3 w-full bg-indigo-600 text-white py-2 rounded-lg font-bold hover:bg-indigo-700 transition flex items-center justify-center gap-2"><Save className="w-4 h-4" />ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ </button>
                                    </div>
                                </div>

                                {/* è¨­å®š: éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */}
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2"><Music className="w-5 h-5 text-pink-500" />PodcastéŸ³å£°è¨­å®š</h2>
                                    <p className="text-xs text-gray-500 mb-4">Podcastå…¨ä½“ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«(mp3ç­‰)ã‚’1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚CSVã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«åŸºã¥ã„ã¦å†ç”Ÿã•ã‚Œã¾ã™ã€‚</p>
                                    
                                    <label className="block w-full cursor-pointer bg-pink-50 hover:bg-pink-100 text-pink-700 py-6 px-4 rounded-xl border-2 border-dashed border-pink-200 text-center transition">
                                        <span className="flex flex-col items-center justify-center gap-2">
                                            <Upload className="w-6 h-6" /> 
                                            <span className="font-bold">éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</span>
                                        </span>
                                        <input type="file" accept="audio/*" className="hidden" onChange={handlePodcastUpload} />
                                    </label>
                                    {podcastAudioSrc && <div className="mt-3 text-xs text-green-600 font-bold text-center flex items-center justify-center gap-1"><Check className="w-3 h-3"/> éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šæ¸ˆã¿</div>}
                                </div>
                            </div>
                        ) : (
                            <>
                                {/* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã‚¿ãƒ– */}
                                <div className="flex bg-gray-200 p-1 rounded-lg">
                                    <button onClick={() => setMode('study')} className={`flex-1 py-2 rounded-md text-sm font-medium transition flex justify-center items-center gap-2 ${mode === 'study' ? 'bg-white shadow text-indigo-600' : 'text-gray-500'}`}><BookOpen className="w-4 h-4" />æ§‹é€ ç†è§£</button>
                                </div>

                                {/* ã‚¸ãƒ£ãƒ³ãƒ—æ©Ÿèƒ½ */}
                                <div className="flex justify-end gap-2 items-center">
                                     <input
                                        type="number"
                                        value={jumpIdInput}
                                        onChange={(e) => setJumpIdInput(e.target.value)}
                                        className="w-20 p-1 border border-gray-300 rounded text-sm text-right"
                                        placeholder="ID No."
                                    />
                                    <button onClick={handleJumpToId} className="bg-gray-200 text-gray-700 px-3 py-1 rounded text-xs font-bold hover:bg-gray-300">Go</button>
                                </div>

                                {mode === 'study' ? (
                                    <div className="space-y-6 animate-fadeIn">
                                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                                            <div className="flex flex-wrap gap-2 mb-4 leading-relaxed">
                                                {currentSentence.chunks && currentSentence.chunks.map((chunk, idx) => (
                                                    <div key={idx} className="group relative cursor-pointer">
                                                        <span className={`inline-block px-2 py-1 rounded border-b-2 text-lg font-medium transition-all hover:opacity-80 ${TYPE_COLORS[chunk.type] || "bg-gray-100"}`}>{chunk.text}</span>
                                                        <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition pointer-events-none z-20 shadow-lg"><p className="font-bold text-center">{chunk.label}</p><p className="text-gray-300 text-center">{chunk.japanese}</p></div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                                            <div className="flex items-center justify-between mb-2">
                                                <h3 className="text-xs font-bold text-indigo-400 uppercase tracking-wider">Meaning</h3>
                                                <label className="flex items-center cursor-pointer">
                                                    <input type="checkbox" checked={showMeaning} onChange={(e) => setShowMeaning(e.target.checked)} className="mr-2" />
                                                    <span className="text-sm font-medium text-gray-700">è¡¨ç¤ºã™ã‚‹</span>
                                                </label>
                                            </div>
                                            {showMeaning && (
                                                <p className="text-gray-700 font-medium animate-fadeIn">{currentSentence.translation}</p>
                                            )}
                                        </div>
                                    </div>
                                ) : null}
                            </>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PodcastChunkMaster />);
    </script>
</body>
</html>